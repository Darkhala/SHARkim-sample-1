<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/images/icon logo.png">
  <title>Sharkim Traders</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
   <style>
    body {
      font-family: "Times New Roman", Times, serif, Arial, Helvetica, sans-serif;
    }
  </style>
</head>
<body class="bg-gray-100 font-[Times_New_Roman,sans-serif]">

<!-- HEADER -->
<header class="bg-black text-white px-4 py-3 relative">

  <!-- Cart button (always top-right) -->
  <button id="cartBtn"
      class="absolute top-2 right-4 flex items-center px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 z-10">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7 4h-2l-1 2H1v2h2l3.6 7.6-1.4 2.4c-.2.3-.2.8 0 1.2.2.4.6.6 1 .6h12v-2H7.4c-.1 0-.2 0-.2-.1l.9-1.5h7.9c.4 0 .7-.2.9-.5l3.6-6.5c.2-.4.1-.8 0-1.1-.2-.3-.5-.5-.9-.5H6.2L5.3 4H7zm0 16c-1.1 0-2 .9-2 2s.9 2 2 2c1.2 0 2-.9 2-2s-.8-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2c1.2 0 2-.9 2-2s-.9-2-2-2z"/>
        </svg>
    Cart
    <span id="cartCount" class="absolute -top-1 -right-1 bg-yellow-400 text-black text-xs font-bold px-2 py-0.5 rounded-full">0</span>
  </button>

  <!-- Logo + H1 -->
<div class="flex flex-col items-center gap-2 mt-6">
  <img src="images/sharkim_gold_logo.png" alt="Sharkim Logo" class="h-20">
  <h1 class="text-lg font-bold" style="color: #ac8334;">usted ordena, entregamos</h1>
</div>

  <!-- Search bar -->
  <div class="flex items-center w-full max-w-md mx-auto mt-4">
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Search products..." 
      class="flex-1 px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-red-500 text-black"
    >
    <button 
      id="searchBtn" 
      class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 flex items-center justify-center"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <circle cx="11" cy="11" r="8" stroke-width="2"/>
        <line x1="21" y1="21" x2="16.65" y2="16.65" stroke-width="2"/>
      </svg>
    </button>
  </div>

</header>

  <!-- BANNER -->
<section 
  class="text-white text-center py-12 bg-cover bg-center relative" 
  style="background-image: url('/images/Banner.png');"
>
  <!-- overlay for readability -->
  <div class="absolute inset-0 bg-black bg-opacity-50"></div>

  <div class="relative z-10">
    <h2 class="text-3xl font-semibold">Best Appliances Discount</h2>
    <p class="text-gray-200">Shop now & save up to 40%</p>
    <button class="mt-4 px-6 py-2 bg-red-600 rounded text-white">Shop Now</button>
  </div>
</section>


  <!-- CATEGORIES BAR -->
  <nav class="bg-white shadow p-3 overflow-x-auto whitespace-nowrap">
    <div id="categoryTabs" class="flex gap-4 text-sm font-medium"></div>
  </nav>

  <!-- MAIN PRODUCT SECTIONS -->
  <main class="p-6 space-y-12" id="mainContent"></main>

  <!-- PRODUCT OVERLAY -->
<div id="productOverlay" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg max-w-4xl w-full relative">
    
    <!-- Close button -->
    <button onclick="closeOverlay()" class="absolute top-2 right-2 text-gray-500 hover:text-black">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- Two-column layout -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <!-- LEFT: Product image -->
      <div class="flex items-center justify-center">
        <img id="overlayImage" src="" alt="" class="max-h-96 object-contain rounded">
      </div>

      <!-- RIGHT: Product details -->
      <div>
        <!-- Title & category -->
        <h2 id="overlayTitle" class="text-2xl font-bold mb-1"></h2>
        <p id="overlayCategory" class="text-sm text-gray-500 mb-3"></p>

        <!-- Price info -->
        <div class="mb-4">
          <p class="line-through text-gray-500">Ksh <span id="overlayOriginal"></span></p>
          <p class="text-red-600 font-bold text-2xl">Ksh <span id="overlayPrice"></span></p>
          <p class="bg-green-600 text-white text-xs inline-block px-2 py-1 rounded mt-1">
            <span id="overlayDiscount"></span>% OFF
          </p>
        </div>

        <!-- Description -->
        <div class="mb-6">
          <h3 class="text-md font-semibold">Description</h3>
          <p id="overlayDescription" class="text-gray-700 text-sm leading-relaxed mt-1"></p>
        </div>

        <!-- Action buttons -->
        <div class="flex flex-wrap gap-3">
          <!-- WhatsApp -->
          <a id="overlayWhatsapp" target="_blank" 
             class="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 32 32" fill="currentColor">
              <path d="M16 .5C7.6.5.5 7.6.5 16c0 2.8.7 5.5 2.2 7.9L0 32l8.3-2.7c2.3 1.3 5 2 7.7 2 8.4 0 15.5-7.1 15.5-15.5S24.4.5 16 .5zM16 29c-2.4 0-4.8-.6-6.9-1.8l-.5-.3-4.9 1.6 1.6-4.8-.3-.5C3.6 21 3 18.6 3 16 3 9.4 9.4 3 16 3s13 6.4 13 13-6.4 13-13 13zm7.3-9.8c-.4-.2-2.3-1.1-2.6-1.2s-.6-.2-.8.2c-.2.4-1 1.2-1.2 1.4s-.4.3-.8.1c-.4-.2-1.6-.6-3-2-1.1-1.1-1.9-2.3-2.1-2.7s0-.6.2-.8.4-.4.6-.6c.2-.2.3-.4.4-.6.1-.2 0-.5 0-.7s-.8-2-1.1-2.8c-.3-.8-.6-.7-.8-.7h-.7c-.2 0-.7.1-1.1.5s-1.4 1.4-1.4 3.4 1.4 3.9 1.6 4.1c.2.2 2.7 4.2 6.5 5.9.9.4 1.7.7 2.2.9.9.3 1.6.3 2.2.2.7-.1 2.3-1 2.6-1.9.3-.9.3-1.7.2-1.9-.1-.2-.3-.3-.7-.5z"/>
            </svg>
            WhatsApp
          </a>

          <!-- Email -->
          <button onclick="openEmailForm(document.getElementById('overlayTitle').innerText)" 
                  class="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zm8 7 8-5H4l8 5zm0 2-8-5v10h16V8l-8 5z"/>
            </svg>
            Email
          </button>

          <!-- Cart -->
          <button id="addToCartBtn" 
                  class="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 4h-2l-1 2H1v2h2l3.6 7.6-1.4 2.4c-.2.3-.2.8 0 1.2.2.4.6.6 1 .6h12v-2H7.4c-.1 0-.2 0-.2-.1l.9-1.5h7.9c.4 0 .7-.2.9-.5l3.6-6.5c.2-.4.1-.8 0-1.1-.2-.3-.5-.5-.9-.5H6.2L5.3 4H7zm0 16c-1.1 0-2 .9-2 2s.9 2 2 2c1.2 0 2-.9 2-2s-.8-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2c1.2 0 2-.9 2-2s-.9-2-2-2z"/>
            </svg>
            Add to Cart
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Email Overlay (existing) -->
  <div id="emailOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white p-6 rounded-lg w-96 shadow-lg">
      <h2 class="text-lg font-bold mb-4">Send Email Inquiry</h2>
      <form id="emailForm" class="space-y-3">
        <input type="hidden" id="productInfo">
        <div>
          <label class="block text-sm">Name:</label>
          <input type="text" id="name" class="w-full border px-3 py-2 rounded" required>
        </div>
        <div>
          <label class="block text-sm">Phone Number:</label>
          <input type="text" id="phone" class="w-full border px-3 py-2 rounded" required>
        </div>
        <div>
          <label class="block text-sm">Location:</label>
          <input type="text" id="location" class="w-full border px-3 py-2 rounded" required>
        </div>
        <div>
          <label class="block text-sm">Message:</label>
          <textarea id="message" class="w-full border px-3 py-2 rounded" rows="4" readonly></textarea>
        </div>
        <div class="flex justify-between mt-4">
          <button type="button" id="cancelEmail" class="px-4 py-2 bg-gray-400 text-white rounded">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded">Send</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Footer Section -->
<footer class="bg-black text-gray-200 mt-10">
  <div class="max-w-7xl mx-auto px-6 py-10 grid grid-cols-1 md:grid-cols-4 gap-8">
    
    <!-- Logo & Contact Info -->
    <div>
      <img src="images/sharkim_gold_logo.png" alt="Company Logo" class="h-14 mb-4">
      <p class="mb-2">WhatsApp Us: <a href="https://wa.me/254704843554" class="text-[#ac8334] font-medium">+254 704 843 554</a></p>
      <p class="mb-2">Call Us: <a href="tel:+254704843554" class="text-white font-medium">+254 704 843 554</a></p>
      <p class="mb-2">Email Us: <a href="mailto:sharkimtraders97@gmail.com" class="text-[#ac8334] font-medium">sharkimtraders97@gmail.com</a></p>
      <p class="text-sm text-gray-400">Time: 8:30AM - 6:30PM</p>
    </div>

    <!-- Categories -->
    <div>
      <h3 class="text-lg font-semibold mb-3 text-white">Categories</h3>
      <ul class="space-y-2">
        <li><a href="#" class="hover:text-[#ac8334]">Electronics</a></li>
        <li><a href="#" class="hover:text-[#ac8334]">Home Appliances</a></li>
        <li><a href="#" class="hover:text-[#ac8334]">Kitchen Appliances</a></li>
        <li><a href="#" class="hover:text-[#ac8334]">Computing & Accessories</a></li>
        <li><a href="#" class="hover:text-[#ac8334]">Small Kitchen Appliances</a></li>
        <li><a href="#" class="hover:text-[#ac8334]">Household Equipments</a></li>
        <li><a href="#" class="hover:text-[#ac8334]">Phones & Tablets</a></li>
        <li><a href="#" class="hover:text-[#ac8334]">Tools & DIY</a></li>
        <li><a href="#" class="hover:text-[#ac8334]">Shoes</a></li>
      </ul>
    </div>

    <!-- Working Hours -->
    <div>
      <h3 class="text-lg font-semibold mb-3 text-white">Working Hours</h3>
      <p class="mb-1">Monday - Saturday: <span class="font-medium">08:30 - 18:30</span></p>
      <p class="mb-1">Sunday: <span class="text-red-500">Closed</span></p>
    </div>

    <!-- Payments -->
    <div>
      <h3 class="text-lg font-semibold mb-3 text-white">Payments</h3>
      <div class="flex space-x-3">
<img src="/images/mpesa1.png" alt="MPESA" class="h-6">
      </div>
    </div>

  </div>

  <!-- Bottom Bar -->
  <div class="bg-black text-[#ac8334] text-center py-3 mt-6">
    <p class="text-sm">&copy; 2025 Sharkim Traders. All rights reserved.</p>
  </div>
</footer>

<script>
// =====================
// CONFIG & SUPABASE
// =====================
const SUPABASE_URL = 'https://evmiakneqtoxvnzeiwlz.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV2bWlha25lcXRveHZuemVpd2x6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMTU4NTEsImV4cCI6MjA2OTg5MTg1MX0.lgW9OGAg8etuIzWPs-t0Ek_P7y3_m5GEo-ZSzbqbsGc';
const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// =====================
// ELEMENTS
// =====================
const mainContent = document.getElementById("mainContent");
const tabs = document.getElementById("categoryTabs");
const searchInput = document.getElementById("searchInput");

const productOverlay = document.getElementById("productOverlay");
const overlayImage = document.getElementById("overlayImage");
const overlayTitle = document.getElementById("overlayTitle");
const overlayCategory = document.getElementById("overlayCategory");
const overlayOriginal = document.getElementById("overlayOriginal");
const overlayPrice = document.getElementById("overlayPrice");
const overlayDiscount = document.getElementById("overlayDiscount");
const overlayWhatsapp = document.getElementById("overlayWhatsapp");
const addToCartBtn = document.getElementById("addToCartBtn");

const emailOverlay = document.getElementById("emailOverlay");
const emailForm = document.getElementById("emailForm");

const cartBtn = document.getElementById("cartBtn");
const cartCountBadge = document.getElementById("cartCount");

// =====================
// CART (localStorage)
// =====================
let cart = JSON.parse(localStorage.getItem("cart") || "[]");
function saveCart() { localStorage.setItem("cart", JSON.stringify(cart)); }
function updateCartCount() {
  if (cartCountBadge) cartCountBadge.innerText = cart.length;
}
updateCartCount();

(function ensureCartDrawer(){
  if (document.getElementById("cartDrawer")) return;
  const drawer = document.createElement("div");
  drawer.id = "cartDrawer";
  drawer.className = "fixed top-0 right-0 w-80 max-w-full h-full bg-white shadow-lg p-4 hidden z-50";
  drawer.innerHTML = `
    <h2 class="text-lg font-bold mb-4">Your Cart</h2>
    <div id="cartItems" class="space-y-3"></div>
    <div class="mt-4 border-t pt-3">
      <p class="font-bold">Total: Ksh <span id="cartTotal">0</span></p>
      <div class="flex gap-2 mt-3">
        <button id="cartWhatsApp" class="bg-green-600 text-white px-3 py-2 rounded w-1/2">WhatsApp</button>
        <button id="cartEmail" class="bg-blue-600 text-white px-3 py-2 rounded w-1/2">Email</button>
      </div>
    </div>
    <button id="cartClose" class="absolute top-2 right-2 text-gray-500">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  `;
  document.body.appendChild(drawer);

  document.getElementById("cartClose").onclick = closeCart;
  document.getElementById("cartWhatsApp").onclick = checkoutWhatsApp;
  document.getElementById("cartEmail").onclick = checkoutEmail;
})();

function openCart() {
  renderCart();
  document.getElementById("cartDrawer").classList.remove("hidden");
}
function closeCart() {
  document.getElementById("cartDrawer").classList.add("hidden");
}
function renderCart() {
  const wrap = document.getElementById("cartItems");
  const totalEl = document.getElementById("cartTotal");
  wrap.innerHTML = "";
  let total = 0;
  if (cart.length === 0) {
    wrap.innerHTML = "<p class='text-gray-500'>Your cart is empty</p>";
    totalEl.innerText = 0;
    return;
  }
  cart.forEach((item, idx) => {
    total += Number(item.price) || 0;
    const row = document.createElement("div");
    row.className = "flex gap-2 items-center border-b pb-2";
    row.innerHTML = `
      <img src="${item.image_url}" alt="${item.title}" class="w-12 h-12 object-contain">
      <div class="flex-1">
        <p class="font-bold text-sm">${item.title}</p>
        <p class="text-xs text-gray-600">Ksh ${item.price}</p>
      </div>
      <button class="text-red-600" aria-label="Remove">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M1 7h22M10 7V5a2 2 0 114 0v2" />
        </svg>
      </button>
    `;
    row.querySelector("button").onclick = () => {
      cart.splice(idx, 1);
      saveCart();
      updateCartCount();
      renderCart();
    };
    wrap.appendChild(row);
  });
  totalEl.innerText = total;
}

function checkoutWhatsApp() {
  if (cart.length === 0) return alert("Your cart is empty!");

  let msg = "ðŸ›’ *New Order from Sharkim Traders*\n\n";
  let total = 0;

  cart.forEach((item, index) => {
    msg += `${index + 1}. ${item.title} - Ksh ${item.price}\n`;
    total += Number(item.price) || 0;
  });

  msg += `\n----------------------\nðŸ’° *Total:* Ksh ${total}\n\n`;
  msg += "ðŸ“ Please confirm delivery details.";

  // replace number with your business WhatsApp number
  const phone = "+254704843554";
  window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, "_blank");
}

function checkoutEmail() {
  if (cart.length === 0) return alert("Your cart is empty!");

  let subject = "ðŸ›’ New Cart Order - Sharkim Traders";
  let body = "Hello Sharkim Traders,\n\nI'd like to order the following products:\n\n";
  let total = 0;

  cart.forEach((item, index) => {
    body += `${index + 1}. ${item.title} - Ksh ${item.price}\n`;
    total += Number(item.price) || 0;
  });

  body += `\n----------------------\nTotal: Ksh ${total}\n\n`;
  body += "Customer details:\nName: __________\nPhone: __________\nLocation: __________";

  window.location.href = `mailto:sharkimtraders97@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}


if (cartBtn) cartBtn.onclick = openCart;

// =====================
// PRODUCTS
// =====================
let categoryContainers = {};
let allProducts = [];

async function fetchProducts() {
  const { data, error } = await client.from('Products').select('*');
  if (error) { console.error("âŒ Error fetching products:", error); return; }
  allProducts = data || [];
  renderCategories(allProducts);
  renderProducts(allProducts);
}

function renderCategories(products) {
  tabs.innerHTML = "";
  categoryContainers = {};
  const counts = {};
  products.forEach(p => {
    if (!counts[p.category]) counts[p.category] = 0;
    counts[p.category]++;
  });
  const sorted = Object.keys(counts).sort((a,b) => counts[b]-counts[a]);
  sorted.forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600";
    btn.innerText = `${cat} (${counts[cat]})`;
    btn.onclick = () => document.getElementById(cat)?.scrollIntoView({ behavior: 'smooth' });
    tabs.appendChild(btn);

    const section = document.createElement("section");
    section.innerHTML = `
      <h2 class="text-xl font-bold mb-4">${cat}</h2>
      <div id="${cat}" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
    `;
    mainContent.appendChild(section);
    categoryContainers[cat] = section.querySelector(`#${CSS.escape(cat)}`);
  });
}

function renderProducts(products) {
  Object.values(categoryContainers).forEach(c => c.innerHTML = "");
  products.forEach(product => {
    const container = categoryContainers[product.category];
    if (!container) return;

    const discount = Math.round(((product.original_price - product.price) / product.original_price) * 100);
    const card = document.createElement('div');
    card.className = "bg-white p-3 rounded shadow text-center cursor-pointer";
    card.innerHTML = `
      <img src="${product.image_url}" alt="${product.title}" class="h-32 mx-auto object-contain mb-2">
      <h3 class="text-sm font-bold">${product.title}</h3>
      <p class="text-xs line-through text-gray-500">Ksh ${product.original_price}</p>
      <p class="text-red-600 font-bold">Ksh ${product.price}</p>
      <span class="bg-green-600 text-white text-xs px-2 py-1 rounded inline-block mt-1">${discount}% OFF</span>
      
      <div class="mt-3 flex justify-center gap-2">
        <!-- WhatsApp with Icon -->
        <a href="https://wa.me/+254704843554?text=I want ${encodeURIComponent(product.title)}" 
           target="_blank" 
           class="flex items-center gap-1 px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 32 32" fill="currentColor">
            <path d="M16 .5C7.6.5.5 7.6.5 16c0 2.8.7 5.5 2.2 7.9L0 32l8.3-2.7c2.3 1.3 5 2 7.7 2 8.4 0 15.5-7.1 15.5-15.5S24.4.5 16 .5zM16 29c-2.4 0-4.8-.6-6.9-1.8l-.5-.3-4.9 1.6 1.6-4.8-.3-.5C3.6 21 3 18.6 3 16 3 9.4 9.4 3 16 3s13 6.4 13 13-6.4 13-13 13zm7.3-9.8c-.4-.2-2.3-1.1-2.6-1.2s-.6-.2-.8.2c-.2.4-1 1.2-1.2 1.4s-.4.3-.8.1c-.4-.2-1.6-.6-3-2-1.1-1.1-1.9-2.3-2.1-2.7s0-.6.2-.8.4-.4.6-.6c.2-.2.3-.4.4-.6.1-.2 0-.5 0-.7s-.8-2-1.1-2.8c-.3-.8-.6-.7-.8-.7h-.7c-.2 0-.7.1-1.1.5s-1.4 1.4-1.4 3.4 1.4 3.9 1.6 4.1c.2.2 2.7 4.2 6.5 5.9.9.4 1.7.7 2.2.9.9.3 1.6.3 2.2.2.7-.1 2.3-1 2.6-1.9.3-.9.3-1.7.2-1.9-.1-.2-.3-.3-.7-.5z"/>
          </svg>
          WhatsApp
        </a>

        <!-- Email with Icon -->
        <button class="flex items-center gap-1 px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zm8 7 8-5H4l8 5zm0 2-8-5v10h16V8l-8 5z"/>
          </svg>
          Email
        </button>
      </div>
    `;

    // Prevent overlay if clicking buttons/links
    card.addEventListener("click", (e)=> {
      if (e.target.closest("a") || e.target.closest("button")) return;
      openOverlay(product);
    });

    card.querySelector("button").onclick = () => openEmailForm(product.title);
    container.appendChild(card);
  });
}

fetchProducts();

if (searchInput) {
  searchInput.addEventListener("input", () => {
    const q = searchInput.value.trim().toLowerCase();

    // If search is empty -> show all
    if (!q) {
      mainContent.innerHTML = "";
      renderCategories(allProducts);
      renderProducts(allProducts);
      return;
    }

    // Filter products
    const filtered = allProducts.filter(p =>
      (p.title || "").toLowerCase().includes(q) ||
      (p.category || "").toLowerCase().includes(q) ||
      (p.subcategory || "").toLowerCase().includes(q)
    );

    mainContent.innerHTML = ""; // clear first

    if (filtered.length === 0) {
      // Show "Not available" message
      const msg = document.createElement("p");
      msg.className = "text-center text-gray-600 mt-6 text-lg font-medium";
      msg.innerText = "âŒ Item not available";
      mainContent.appendChild(msg);
      return;
    }

    // Only render categories that matched
    renderCategories(filtered);
    renderProducts(filtered);
  });
}

// =====================
// PRODUCT OVERLAY + EMAIL
// =====================
function openOverlay(product) {
  overlayImage.src = product.image_url;
  overlayTitle.innerText = product.title;
  overlayCategory.innerText = product.category;
  overlayDescription.innerText = product.subcategory || "No description available";
  overlayOriginal.innerText = product.original_price;
  overlayPrice.innerText = product.price;
  overlayDiscount.innerText = Math.round(((product.original_price - product.price) / product.original_price) * 100);
  overlayWhatsapp.href = `https://wa.me/254700000000?text=${encodeURIComponent("I want " + product.title)}`;

  addToCartBtn.onclick = () => {
    cart.push({
      id: product.id,
      title: product.title,
      price: product.price,
      image_url: product.image_url
    });
    saveCart();
    updateCartCount();
    alert("Added to cart âœ…");
  };

  productOverlay.classList.remove("hidden");
}

function closeOverlay(){ productOverlay.classList.add("hidden"); }
window.closeOverlay = closeOverlay;

function openEmailForm(productTitle) {
  emailOverlay.classList.remove("hidden");
  const message = `I want ${productTitle}`;
  document.getElementById("productInfo").value = productTitle;
  document.getElementById("message").value = message;
}
document.getElementById("cancelEmail").onclick = function() {
  emailOverlay.classList.add("hidden");
};

emailForm.onsubmit = function(e) {
  e.preventDefault();
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const location = document.getElementById("location").value;
  const product = document.getElementById("productInfo").value;
  const emailMessage = document.getElementById("message").value;
  const body = `Product: ${product}%0AName: ${name}%0APhone: ${phone}%0ALocation: ${location}%0AMessage: ${emailMessage}`;
  window.location.href = `mailto:sharkimtraders97@gmail.com?subject=Product Inquiry&body=${body}`;
  emailOverlay.classList.add("hidden");
};
</script>

</body>
</html>

